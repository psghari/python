user_account = {'Bruce':{'balance':0,'password':'batman'}}

def new_user_creation():
    global user_account
    while True:
        username = input('Please enter your desired username: ')
        if username not in user_account: 
            print("Congrats this username is available!")
            user_password = input("Please enter your desired password: ")
            user_account[username] = {"balance": 0, "password": user_password}
            break
        else:
            print('Username already exists. Please try again.')

def login_function():
    get_username = input("Please enter your username: ").strip()
    get_password = input("Please enter your password: ").strip()
    if get_username in user_account and user_account[get_username]["password"] == get_password:
        print(f"Welcome to your account {get_username}. Your current balance is: {user_account[get_username]['balance']}")
        return get_username
    else:
        print("Invalid username or password.")
        return None

def post_login(username):
    while True:
        post_login_menu = {1:'Deposit money',2:'Withdraw money',3:'Check balance',4:'Back to main menu',5:'Exit'}
        print(f'Hello, please chose one of the following options: ')
        for key, value in post_login_menu.items():
            print(f'{key},{value}')
        selection = int(input('Please select an option to continue'))
        if selection == 1:
            credit_balance(username)
        elif selection == 2:
            debit_balance(username)
        elif selection == 3:
            balance_check(username)
        elif selection == 4:
            banking_menu(username)
        elif selection == 5:
            exit()
        else:
            print('Invalid input please try again.')

def credit_balance(username):
    while True:
        try:
            deposit_money = int(input("Please enter the amount to deposit: "))
            if deposit_money <= 0:
                print("Please enter a positive amount.")
            else:
                user_account[username]["balance"] += deposit_money
                print(f"Deposit successful! New balance: {user_account[username]['balance']}")
                break
        except ValueError:
            print("Invalid input. Please enter a valid amount.")

def debit_balance(username):
    while True:
        try:
            withdraw_money = int(input("Please enter the amount to withdraw: "))
            if user_account[username]["balance"] == 0 or withdraw_money > user_account[username]["balance"]:
                print("You do not have enough balance to make a withdrawl")
                break
            elif withdraw_money <= 0:
                print("Please enter a valid amount.")
            else:
                user_account[username]["balance"] -= withdraw_money
                print(f"Withdrawl successful! New balance: {user_account[username]['balance']}")
                break
        except ValueError:
            print(f"Invalid input. Please enter a valid amount.") 


def balance_check(username):
    print(f"The balance in your account is {user_account[username]['balance']}")

def banking_menu():
    banking_menu = {1: 'Create acccount',2: 'Login',3:'Exit'}

    while True:
        print(f'Hello {user_introduction}, please chose one of the following options: ')
        for key, value in banking_menu.items():
            print(f'{key}:{value}')
        selection = int(input('Please select an option to continue: '))
        if selection == 1:
            new_user_creation()
        elif selection == 2:
            logged_in_user = login_function()
            if logged_in_user:
                post_login(logged_in_user)
        elif selection == 3:
            exit()
        else:
            print('Please enter a valid input.')

def exit():
    print('Thank you for visiting us today. Bye!')
    quit()

user_introduction = input("Hello there, welcome to Wayne commercial bank, please tell us your name: ").strip()
banking_menu()
